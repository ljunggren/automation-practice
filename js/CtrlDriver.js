var _CtrlDriver={_tmpValue:0,_curDomItem:null,_curSignedList:[],_updateUIList:[],_cleanList:[],_refershDataList:[],_arrayUIList:[],_proxyTypes:[Location,Object,Array],_isProxibleObj:function(e){return e&&!e._isBZProxy&&_CtrlDriver._proxyTypes.indexOf(e.constructor)>=0},_mergeData:function(e,r){for(var t in e)r[t]=e[t]},_replaceData:function(e,r){_CtrlDriver._mergeData(e,r);for(var t in r)e[t]!=r[t]&&(r[t]=void 0)},_createBZArea:function(e){var r=$(e).find("#bz-tmp-area");return r.length||($("<div id='bz-tmp-area'></div>").insertAfter(e.body),r=$(e).find("#bz-tmp-area")),r},_execute:function(e,r,t,_){if(_doc=e._document||document,r=r||e._data||{},t=t||e._viewDef,_=_||e._area||(_doc==document?_doc.body:_CtrlDriver._createBZArea(_doc)),e._data||(e._data=r),r==e._data)r=_CtrlDriver._buildProxy(r),e._data=r;else if(!r._isBZProxy)throw Error("Data is not build in binding. ('"+JSON.stringify(r,0,2)+"')");_CtrlDriver._initUIBind(e,r,t);var i=_CtrlDriver._drawView(e,r,t,_);return _CtrlDriver._curDomItem=null,i},_buildProxy:function(e,r,t){return e._isBZProxy?e:new Proxy(e,{_parent:r,_name:t,get:function(e,r){if("_isBZProxy"==r)return!0;if("_uiMap"==r)return this._uiMap||(this._uiMap={}),this._uiMap;if("constructor"==r)return e.constructor;if("_target"==r)return e;var t=e[r];return this._uiMap||(this._uiMap={}),_CtrlDriver._isProxibleObj(t)&&(e[r]=_CtrlDriver._buildProxy(e[r],this,r)),_CtrlDriver._curDomItem?(this._uiMap[r]||!_CtrlDriver._isProxibleObj(e)||t&&t.constructor==Function||e.constructor==Array&&"length"==r||(this._uiMap[r]=[]),t&&t.constructor==Array&&!e[r]._uiMap.splice&&(e[r]._uiMap.splice=this._uiMap[r],e[r]._uiMap.push=this._uiMap[r],e[r]._uiMap.unshift=this._uiMap[r],e[r]._uiMap.pop=this._uiMap[r],e[r]._uiMap.shift=this._uiMap[r]),this._uiMap[r]&&(t&&t.constructor==Function?_CtrlDriver._updateArrayUI(this._uiMap[t.name]):_CtrlDriver._bindUI(this._uiMap[r]))):t&&e.constructor==Array&&t.constructor==Function&&["splice","push","unshift","pop","shift"].indexOf(t.name)>=0&&_CtrlDriver._updateArrayUI(this._uiMap[t.name]),e[r]},set:function(e,r,t){if(_CtrlDriver._isProxibleObj(t)&&(t=_CtrlDriver._buildProxy(t,this,r)),(t&&e[r]&&t._target&&e[r]._target?t._target!==e[r]._target:e[r]!==t)&&(this._uiMap&&this._uiMap[r]&&_CtrlDriver._updateUIList.indexOf(this._uiMap[r])<0?(_CtrlDriver._updateUIList.push(this._uiMap[r]),_CtrlDriver._exeUpdateUI()):this._parent&&this._parent._uiMap[this._name]&&(_CtrlDriver._updateUIList.push(this._parent._uiMap[this._name]),_CtrlDriver._exeUpdateUI()),_CtrlDriver._rootUpdateMap&&(_CtrlDriver._updateUIList.push(_CtrlDriver._rootUpdateMap),_CtrlDriver._exeUpdateUI())),e[r]&&e[r]._uiMap&&(t&&t._isBZProxy&&!t._uiMap&&(t[0],delete t._uiMap[0]),t&&t._uiMap&&t._uiMap!=e[r]._uiMap))for(var _ in e[r]._uiMap){var i=t._uiMap[_],a=e[r]._uiMap[_];if(i&&i!=a)for(var o=0;o<a.length;o++)i.includes(a[o])||i.push(a[o]);else t._uiMap[_]=e[r]._uiMap[_];_CtrlDriver._cleanList.push(t._uiMap[_])}var l=e[r]=t;return void 0===t&&this._uiMap&&delete this._uiMap[r],e.constructor==Array&&"length"==r&&0==l||(!(e.constructor!=Array||!parseInt(r)&&0!=parseInt(r)||l)||l)}})},_updateArrayUI:function(e){if(e)return _CtrlDriver._arrayUIList.indexOf(e)<0&&_CtrlDriver._arrayUIList.push(e),_CtrlDriver._arrayUITimeout&&clearTimeout(_CtrlDriver._arrayUITimeout),void(_CtrlDriver._arrayUITimeout=setTimeout("_CtrlDriver._updateArrayUI()"));var r=Date.now();for(_CtrlDriver._inUpdateArrayUIList=!0;_CtrlDriver._arrayUIList.length;){var t=_CtrlDriver._arrayUIList.shift();_CtrlDriver._updateDataUI(t,r)}_CtrlDriver._inUpdateArrayUIList=!1},_updateDataUI:function(e,r){if(e)for(var t=0;t<e.length;t++){var _=e[t];if(_._dom.parentNode){if(r&&_._time>r)continue;try{_CtrlDriver._curSignedList=[],_CtrlDriver._updateCount++,_CtrlDriver._curDomItem=_,"_if"==_._attr?_CtrlDriver._updateIf(_):"['load']"==_._attr?_CtrlDriver._loadContent(_):"['html']"==_._attr?_CtrlDriver._updateHtml(_):"['text']"==_._attr?_._dom._viewDef._text&&_CtrlDriver._updateText(_):"['value']"==_._attr?_CtrlDriver._updateValue(_):"rebuild"==_._attr?_CtrlDriver._updateRebuild(_):"repeat"==_._attr?_CtrlDriver._updateRepeat(_):_CtrlDriver._updateAttr(_)}catch(e){_CtrlDriver._handleError(e)}}else e.splice(t,1),t--}},_handleError:function(e){window._inDebugging&&console.log(e.stack)},_initUIBind:function(e,r,t,_){_CtrlDriver._curSignedList=[];var i=e._document||document;_CtrlDriver._curDomItem=i.createTextNode(""),_CtrlDriver._curDomItem._ctrl=e,_CtrlDriver._curDomItem._data=r,_CtrlDriver._curDomItem._viewDef=t,_CtrlDriver._curDomItem._hookers=_||[],_CtrlDriver._curDomItem={_dom:_CtrlDriver._curDomItem,_attr:"_if"}},_initUIBindByDom:function(e){_CtrlDriver._initUIBind(e._ctrl,e._data,e._viewDef,e._hookers)},_changeBindAttr:function(e){_CtrlDriver._curDomItem={_dom:_CtrlDriver._curDomItem._dom,_attr:e}},_replaceBindDom:function(e,r,t){e&&(e._ctrl=_CtrlDriver._curDomItem._dom._ctrl,e._data=_CtrlDriver._curDomItem._dom._data,e._viewDef=_CtrlDriver._curDomItem._dom._viewDef,e._hookers=_CtrlDriver._curDomItem._dom._hookers,_CtrlDriver._curDomItem._dom=e),r&&(_CtrlDriver._curDomItem._attr=r);for(var _=0;_<_CtrlDriver._curSignedList.length;_++){var i=_CtrlDriver._curSignedList[_];e&&(i._dom=e),r&&(i._attr=r)}t&&(_CtrlDriver._curSignedList=[])},_retrieveResult:function(_exe,_data,_ctrl,_dom){var _result=null;try{if(_exe&&_exe.constructor==Function)_result=_exe(_data,_ctrl,_dom);else if(!_exe||_exe.constructor!=Array&&_exe.constructor!=Object)if(_exe&&_exe.constructor!=String)_result=_exe;else try{_exe&&(_exe.includes(".")||_exe.endsWith("'")&&"'"==_exe[0])&&!_exe.endsWith(".")?eval("_result="+_exe):_result=_exe}catch(e){_result=_exe,e.message&&(e.message.includes("null")||e.message.includes("undefined"))&&(_exe.constructor==String&&(_result=""),window.SERVER_HOST&&window.SERVER_HOST.startsWith("//localhost")?_result=_exe:window.BZM&&location.host.startsWith("localhost")&&(_result=_exe))}else _result=_exe}catch(e){e.message&&(e.message.endsWith("of null")||e.message.endsWith("of undefined"))||console.error(e)}return _result},_bindUI:function(e){for(var r=0;r<e.length;r++){var t=e[r];if(t._dom==_CtrlDriver._curDomItem._dom&&t._attr==_CtrlDriver._curDomItem._attr){if("repeat"==t._attr&&t._viewDef._dataRepeat!==_CtrlDriver._curDomItem._viewDef._dataRepeat)continue;return}}e.includes(_CtrlDriver._curDomItem)||(_CtrlDriver._curDomItem._time=Date.now(),e.push(_CtrlDriver._curDomItem),_CtrlDriver._curSignedList.push(_CtrlDriver._curDomItem),_CtrlDriver._cleanList.push(e),_CtrlDriver._exeCleanList())},_cleanDom:function(e){for($(e).remove();e.childNodes.length;)_CtrlDriver._cleanDom(e.childNodes[0])},_cleanData:function(e){if(e.constructor==Array)for(;e.length;)e.pop();else for(var r in e)e[r]=null,delete e[r]},_exeCleanList:function(e){if(!e)return _CtrlDriver._curCleanListTimeout&&clearTimeout(_CtrlDriver._curCleanListTimeout),void(_CtrlDriver._curCleanListTimeout=setTimeout("_CtrlDriver._exeCleanList(1)",1));for(var r=Date.now();_CtrlDriver._cleanList.length;){var t=_CtrlDriver._cleanList.shift(),_=[],i=[];0;for(var a=0;a<t.length;a++){var o=t[a];0;var l=t.indexOf(o);if(l>=0&&l!=a)t.splice(a,1),0,a--;else if(o._dom.parentNode&&o._dom.ownerDocument&&o._dom.ownerDocument.defaultView||!(o._time<r))if(_.indexOf(o._dom)<0)i.push([o._attr]),_.push(o._dom);else{var d=_.indexOf(o._dom);"repeat"==o._attr||i[d].indexOf(o._attr)<0?i[d].push(o._attr):(t.splice(a,1),a--,0)}else t.splice(a,1),0,a--}}},_exeUpdateUI:function(e){if(!e)return _CtrlDriver._curUIUpdateTimeout&&clearTimeout(_CtrlDriver._curUIUpdateTimeout),void(_CtrlDriver._curUIUpdateTimeout=setTimeout("_CtrlDriver._exeUpdateUI(1)",1));var r=Date.now();_CtrlDriver._updateCount=0;for(var t=[];_CtrlDriver._updateUIList.length;){for(var _=_CtrlDriver._updateUIList.shift(),i=0;i<_.length;i++){var a=_[i];t.indexOf(a)<0&&t.push(a)}_CtrlDriver._cleanList.push(_)}_CtrlDriver._updateDataUI(t,r),_CtrlDriver._exeCleanList(),_CtrlDriver._curDomItem=null,_CtrlDriver._curSignedList=[]},_updateValue:function(u){var _data=u._dom._data,_viewDef=u._dom._viewDef,_value=null;try{if(_viewDef._dataModel.constructor==Function?eval("_value="+_viewDef._dataModel(_data)):eval("_value="+_viewDef._dataModel),_viewDef._formatGet&&(_value=_viewDef._formatGet(_value,_data)),void 0!==_value&&null!==_value||(_value=""),_value=_value.toString(),u._dom.type&&"checkbox"==u._dom.type.toLowerCase())u._dom.checked=_value==u._dom.value;else if(u._dom.type&&"radio"==u._dom.type.toLowerCase())u._dom.checked=$(u._dom).val()==_value;else if("SELECT"==u._dom.tagName)for(var ps=u._dom.options,i=0;i<ps.length;i++){var p=ps[i];if(p._orgValue==_value||p.value==_value)return void(u._dom.value=p.value)}else{var _focus=$("*:focus")[0]==u._dom;_focus?(_CtrlDriver._inTyping=!0,u._dom._bzTypingBlur||(u._dom._bzTypingBlur=!0,$(u._dom).blur(function(){this._bzTypingBlur=!1,_CtrlDriver._inTyping=!1}))):u._dom.value=_value}}catch(e){_CtrlDriver._handleError(e)}},_updateAttr:function(u){var _data=u._dom._data,_viewDef=u._dom._viewDef;if(_viewDef._attr){var _value="";eval("_value=_viewDef"+u._attr);var _result=_CtrlDriver._retrieveResult(_value,_data,u._dom._ctrl,u._dom);if(_result=void 0===_result?"":_result,"['_attr']['style']"==u._attr){if(_result){_result=_result.split(";");for(var i=0;i<_result.length;i++){var r=_result[i].split(":");u._dom.style[r[0]]=r[1]}}}else if("['_attr']['class']"==u._attr)u._dom.className=_result;else{var _attr=u._attr.split("]['")[1].split("'")[0];["disabled","readonly","checked","selected"].includes(_attr)&&(_result=Boolean(_result)),"value"==_attr?u._dom.value=_result:$(u._dom).attr(_attr,_result)}}},_loadContent:function(u){var _dom=_CtrlDriver._curDomItem._dom;u?(_CtrlDriver._curDomItem=u,_dom=u._dom):_CtrlDriver._curDomItem={_dom:_dom,_attr:"['load']"};var _data=_dom._data,_ctrl=_dom._ctrl,_ajax=_dom._viewDef._load;if(_ajax.constructor!=Function&&_ajax.constructor!=String||(_ajax=_CtrlDriver._retrieveResult(_ajax,_dom._data,_dom._ctrl)),_ajax.constructor==String&&(_ajax={url:_ajax,dataType:"text/plain"}),_CtrlDriver._equalObj(_dom._viewDef._lastLoad,_ajax)&&!_ajax._noCache)return _dom._viewDef._html?_CtrlDriver._updateHtml(u):_dom._viewDef._text?_CtrlDriver._updateText(u):_dom;function _buildDom(d){d.responseText&&(d=d.responseText),_ajax._handler&&(d=_ajax._handler(d));var dd=null,_doc=_dom._ctrl._document||document,_box=_doc==document?_doc.body:_CtrlDriver._createBZArea(_doc);try{"SCRIPT"==_dom.tagName?eval(d):(eval("dd="+d),_dom._viewDef=dd,dd=_CtrlDriver._drawView(_dom._ctrl,_dom._data,_dom._viewDef,_box,_dom))}catch(e){var dd=$(d)[0];dd||(dd=_doc.createTextNode(d))}if(dd){if(dd._ctrl=_dom._ctrl,dd._data=_dom._data,dd._viewDef=_dom._viewDef,dd._viewDef._load)return dd.outerHTML?dd._viewDef._html=d:dd._viewDef._text=d,_dom._resultDom&&$(_dom._resultDom).remove(),$(dd).insertAfter(_dom),_dom._resultDom=dd,dd;$(_dom).replaceWith(dd)}}return _dom._viewDef._lastLoad=_ajax,$.ajax(_ajax).fail(function(e){e.message?alert("Load page error: "+e.message):e.responseText&&_buildDom(e)}).done(function(e){_buildDom(e)}),_dom},_updateHtml:function(e){_CtrlDriver._curDomItem=e||{_dom:_CtrlDriver._curDomItem._dom,_attr:"['html']"};var r=_CtrlDriver._curDomItem._dom._ctrl._document||document,t=_CtrlDriver._curDomItem._dom,_=_CtrlDriver._retrieveResult(t._viewDef._html,t._data,t._ctrl),i=null;return null!==_&&void 0!==_?(_.constructor==String&&(_=_.trim()),_.constructor==String&&"<"==_[0]&&">"==_[_.length-1]?i=$(_)[0]:_.nodeType&&(i=_),i||(i=r.createTextNode(_))):i=r.createTextNode(""),e&&$(e._dom).replaceWith(i),_CtrlDriver._replaceBindDom(i,"['html']",!0),i},_updateText:function(e){_CtrlDriver._curDomItem=e||{_dom:_CtrlDriver._curDomItem._dom,_attr:"['text']"};_CtrlDriver._curDomItem._dom._ctrl._document||document;var r=_CtrlDriver._curDomItem._dom,t=_CtrlDriver._retrieveResult(r._viewDef._text,r._data,r._ctrl);return null!==t&&void 0!==t||(t=""),_CtrlDriver._curDomItem._dom.textContent=t,_CtrlDriver._replaceBindDom(null,"['text']",!0),r},_updateRebuild:function(e){e._dom.parentNode;var r=_CtrlDriver._drawView(e._dom._ctrl,e._dom._data,e._dom._viewDef);if(r){r.constructor!=Array&&(r=[r]);for(var t=0;t<r.length;t++)$(r[t]).insertAfter(e._dom)}_CtrlDriver._cleanDom(e._dom)},_updateIf:function(e){e&&_CtrlDriver._initUIBindByDom(e._dom);var r=_CtrlDriver._curDomItem._dom,t=_CtrlDriver._retrieveResult(r._viewDef._if,r._data,r._ctrl);if(!t||t.constructor==String&&t==r._viewDef._if){if(e&&e._dom.nodeType==r.nodeType&&!e._dom.textContent)return void(_CtrlDriver._curDomItem._dom=e._dom);if(e){var _=_CtrlDriver._curDomItem._dom;function i(){$(e._dom).replaceWith(_),_CtrlDriver._cleanDom(e._dom),e._dom=_}return void(!(r._viewDef._animation&&r._viewDef._animation._hide||_CtrlDriver._animationHideAll)||r._viewDef._animation&&"none"==r._viewDef._animation._hide?i():r._viewDef._animation&&r._viewDef._animation._hide?r._viewDef._animation._hide(e._dom,function(){i()}):_CtrlDriver._animationHideAll(e._dom,function(){i()}))}return null}if(!e||e._dom.nodeType==r.nodeType&&!e._dom.textContent){if(!e)return _CtrlDriver._curDomItem;if(e._dom._viewDef._dataRepeat)_CtrlDriver._repeatData(e._dom._ctrl,e._dom._data,e._dom._viewDef,e._dom.parentNode,e._dom),_CtrlDriver._cleanDom(e._dom);else{var a=((r=_CtrlDriver._updateDom(e))._viewDef._animation&&r._viewDef._animation._show||_CtrlDriver._animationShowAll)&&(!r._viewDef._animation||"none"!=r._viewDef._animation._show);a&&r.tagName&&(r.style.display="none"),$(e._dom).replaceWith(r),a&&r.tagName&&(r._viewDef._animation&&r._viewDef._animation._show?r._viewDef._animation._show(r):_CtrlDriver._animationShowAll&&_CtrlDriver._animationShowAll(r))}}},_buildDom:function(e){var r=(e=e._dom)._data,t=_CtrlDriver._retrieveResult(e._viewDef._tag,e._data,e._ctrl),_="<"+t+" ",i=_CtrlDriver._fillAttrs(e._viewDef,r,e._ctrl);null===i||i&&(i.constructor==Object||i.constructor==Array)?_+=i._html:_+=i,["INPUT","IMG","BR","HR"].indexOf(t.toUpperCase())>=0?_+="/>":_+="></"+t+">";var a=$(_)[0];return(null===i||i&&(i.constructor==Object||i.constructor==Array))&&(a._orgValue=i._orgValue),a},_updateDom:function(u){var _dom=_CtrlDriver._buildDom(u);_CtrlDriver._replaceBindDom(_dom,null,!0),_CtrlDriver._bindJqExt(_dom._viewDef._jqext,_dom),_CtrlDriver._setBZCommonBehavior(_dom);var id=null;if(_dom._viewDef.id?id=_dom._viewDef.id:_dom._viewDef._attr&&_dom._viewDef._attr.id&&(id=_dom._viewDef._attr.id),id&&(_dom._ctrl._comps||(_dom._ctrl._comps={}),_dom._ctrl._comps[id]=_dom),_dom._viewDef._items){var _items=_dom._viewDef._items;_items.constructor!=String&&_items.constructor!=Function||(_items=_CtrlDriver._retrieveResult(_items,_dom._data,_dom._ctrl,_dom));for(var i=0;i<_items.length;i++){var r=_items[i];_CtrlDriver._drawView(_dom._ctrl,_dom._data,r,_dom)}}else _dom._viewDef._load?_dom=_CtrlDriver._loadContent():_dom._viewDef._html?$(_dom).append(_CtrlDriver._updateHtml()):_dom._viewDef._text&&$(_dom).append(_CtrlDriver._updateText());if(_dom._viewDef._required){var _required=_CtrlDriver._retrieveResult(_dom._viewDef._required,_dom._data,_dom._ctrl);_required&&($(_dom).val()||$(_dom).addClass("required"),$(_dom).on("input",function(){this.value?$(this).removeClass("required"):$(this).addClass("required")}))}if(_dom._viewDef._dataModel){var _tag=_CtrlDriver._retrieveResult(_dom._viewDef._tag,_dom._data,_dom._ctrl);if(["INPUT","SELECT","TEXTAREA"].indexOf(_tag.toUpperCase())>=0){if(_dom._viewDef._attr&&_dom._viewDef._attr.type)var type=_CtrlDriver._retrieveResult(_dom._viewDef._attr.type,_dom._data,_dom._ctrl);else type="text";var _event="change";["INPUT","TEXTAREA"].indexOf(_dom.tagName)>=0&&"checkbox"!=type&&"radio"!=type&&(_event="input"),_event=_dom._viewDef._updateEvent||_event,$(_dom).on(_event,function(){_CtrlDriver._typingBox=this;var _data=this._data,_bind=this._viewDef._dataModel;if(_bind.constructor==Function&&(_bind=_bind(_data)),"checkbox"==this.type)this.checked?eval(_bind+"=this.value"):(eval(_bind+"=null"),eval("delete "+_bind));else{var _value=null;this._viewDef._dataType==Number?(_value=parseFloat(this.value),_value||(_value=0)):_value=this.value,"SELECT"==this.tagName&&this.selectedOptions[0]._orgValue&&(_value=this.selectedOptions[0]._orgValue),this._viewDef._formatSet&&(_value=this._viewDef._formatSet(_value,_data)),eval(_bind+"=_value")}}),$(_dom).on("blur",function(){_CtrlDriver._typingBox=null});var _data=_dom._data;_CtrlDriver._curDomItem={_dom:_dom,_attr:"['value']"};try{if(_dom._viewDef._dataModel.constructor==Function?eval("_value="+_dom._viewDef._dataModel(_data)):eval("_value="+_dom._viewDef._dataModel),"checkbox"==type)_dom.checked=_dom.value+""==(_value?_value+"":"");else if("radio"==type)_dom.checked=_dom.value==(_value?_value+"":"");else if(_dom._viewDef._formatGet&&(_value=_dom._viewDef._formatGet(_value,_data)),$(_dom).val(_value),(null===_value||_value&&(_value.constructor==Object||_value.constructor==Array))&&(_dom._orgValue=_value,"SELECT"==_dom.tagName))for(var i=0;i<_dom.options.length;i++){var op=_dom.options[i];if(op._orgValue==_value||op._orgValue&&_value&&_dom._viewDef._key&&op._orgValue[_dom._viewDef._key]==_value[_dom._viewDef._key]){op.selected=!0;break}}}catch(e){_CtrlDriver._handleError(e)}}else{_CtrlDriver._curDomItem={_dom:_dom,_attr:"rebuild"};try{var _data=_dom._data;eval(_dom._viewDef._dataModel)}catch(e){_CtrlDriver._handleError(e)}}}if(_dom._viewDef._focus){var _focus=!_CtrlDriver._inTyping&&_CtrlDriver._retrieveResult(_dom._viewDef._focus,_dom._data,_dom._ctrl);_focus&&setTimeout(function(){_CtrlDriver._inTyping||$(_dom).focus()},10)}return _CtrlDriver._curSignedList=[],_dom},_updateRepeat:function(e){var r=e._supData;_CtrlDriver._curDomItem=e,(r=_CtrlDriver._retrieveResult(e._group,r,e._ctrl))&&r.constructor==Number?(r=new Array(r).fill(0),_CtrlDriver._updateRepeatInArray(e,r)):r&&r.constructor==Array?_CtrlDriver._updateRepeatInArray(e,r):_CtrlDriver._updateRepeatInObject(e,r)},_updateRepeatInArray:function(e,r){for(var t=0,_=null,i=0;i<e._dom.childNodes.length;i++){var a=e._dom.childNodes[i];if(a._data&&a._data._group==e._group&&a._data._supData==e._supData){if(!$.isNumeric(a._data._idx)){_CtrlDriver._cleanDom(a);continue}if(a._data._idx==t)if(_=a,!r||t>=r.length)_CtrlDriver._cleanDom(a),i--;else if(a._data._item!=r[t]){try{if(JSON.stringify(a._data._item)==JSON.stringify(r[t])&&_CtrlDriver._typingBox&&$(a).find(_CtrlDriver._typingBox).length)return}catch(e){}a._data._item=r[t];var o=_CtrlDriver._drawView(a._ctrl,a._data,a._viewDef);$(a).replaceWith(o),_CtrlDriver._cleanDom(a),_=o}t++}else if(t)break}var l=_CtrlDriver._clone(e._viewDef);delete l._dataRepeat;for(var d=t;r&&d<r.length;d++){o=_CtrlDriver._drawView(e._ctrl,{_item:r[d],_group:e._group,_supData:e._supData,_idx:d,_key:d},l);_?$(o).insertAfter(_):$(e._dom).append(o),_=o}},_updateRepeatInObject:function(e,r){var t=_CtrlDriver._clone(e._viewDef);delete t._dataRepeat;for(var _=0,i="append",a=null;e._dom.childNodes.length>_;){var o=e._dom.childNodes[_],l=!1;try{l=JSON.stringify(o._viewDef)==JSON.stringify(t)}catch(e){}l?(_CtrlDriver._cleanDom(o),i="append"):(_++,a=o,i="insertBefore")}for(var d in r){var u=_CtrlDriver._drawView(e._ctrl,{_item:r[d],_group:e._group,_supData:e._supData,_idx:d,_key:d},t);"append"==i?$(e._dom).append(u):$(u).insertBefore(a)}},_repeatData:function(e,r,t,_,i){_CtrlDriver._curDomItem={_dom:_,_attr:"repeat",_time:Date.now(),_group:t._dataRepeat,_supData:r,_ctrl:e,_viewDef:t};var a=_CtrlDriver._retrieveResult(t._dataRepeat,r,e),o=[];if(a&&a.constructor!=String){a.constructor==Number&&(a=new Array(a).fill(0));var l=_CtrlDriver._clone(t);delete l._dataRepeat;for(var d in a)$.isNumeric(d)&&(d=parseInt(d)),o.push(_CtrlDriver._drawView(e,{_item:a[d],_group:t._dataRepeat,_supData:r,_idx:d,_key:d},l,_,i)),_CtrlDriver._curDomItem={_dom:_,_attr:"repeat",_time:Date.now(),_group:t._dataRepeat,_supData:r,_ctrl:e,_viewDef:t}}return o},_drawView:function(e,r,t,_,i){if(_CtrlDriver._initUIBind(e,r,t),void 0===t._if||_CtrlDriver._updateIf()){if(t._dataRepeat)return _CtrlDriver._repeatData(e,r,t,_);var a=null;return t._tag?a=_CtrlDriver._updateDom(_CtrlDriver._curDomItem):t._load?a=_CtrlDriver._loadContent():t._html?a=_CtrlDriver._updateHtml():t._text&&(a=_CtrlDriver._updateText()),i?$(a).insertAfter(i):_&&$(_).append(a),a}i?$(_CtrlDriver._curDomItem._dom).insertAfter(i):$(_).append(_CtrlDriver._curDomItem._dom)},_fillAttrs:function(e,r,t){var _="",i=null;if(e._attr){for(var a in e._attr){var o=a.match(/^on[a-z]+/),l=e._attr[a];o&&o[0]==a&&l.constructor===String||(_CtrlDriver._curDomItem={_dom:_CtrlDriver._curDomItem._dom,_attr:"['_attr']['"+a+"']"},l=void 0===(l=_CtrlDriver._retrieveResult(l,r,t))?"":l,!(["disabled","readonly","selected","checked"].indexOf(a)>=0))?((null===l||l&&(l.constructor==Array||l.constructor==Object))&&(i=l,l=_CtrlDriver._tmpValue++),_+=" "+a+"="+(l=l.includes&&l.includes('"')?l.includes("'")?'"'+l.replace(/"/g,"&quot;")+'"':"'"+l+"'":'"'+l+'"')):l&&(_+=" "+a+'="true"')}"input"!=_CtrlDriver._retrieveResult(e._tag,r,t).toLowerCase()||e._attr.type||(_+=' type="text"')}return i?{_orgValue:i,_html:_}:_},_bindJqExt:function(_jqext,_jq){if(_jqext){var _data=_jq._data;_jq=$(_jq);for(var k in _jqext)_jqext[k].constructor==String&&eval("_jqext[k]="+_jqext[k]),$.isArray(_jqext[k])?_jq[k](_jqext[k][0],_jqext[k][1]):_jq[k](_jqext[k])}},_setBZCommonBehavior:function(e){"INPUT"!=e.tagName||e.type&&"text"!=e.type||$(e).focus(function(){this.select()})},_cleanFromData:function(e){var r=0,t=0;if(e&&e._uiMap)for(var _ in e._uiMap){for(var i=e._uiMap[_],a=0;a<i.length;a++){var o=i[a];r++,o._dom&&o._dom.parentNode||(i.splice(a,1),t++,a--)}var l=_CtrlDriver._cleanFromData(e[_]);r+=l._count,t+=l._clean}return{_count:r,_clean:t}},_clone:function(e){return"array"==$.type(e)?$.extend(!0,[],e):"object"==$.type(e)?$.extend(!0,{},e):e},_equalObj:function(e,r){return e==r?1:e&&r?(e=JSON.stringify(e))==(r=JSON.stringify(r))?1:e.constructor!==String||r.constructor!==String||e.length!=r.length?0:(e=JSON.parse(e),r=JSON.parse(r),this._sortJson(e)==this._sortJson(r)):0},_sortJson:function(e,r,t){t||(t="");var _="";if(e&&e.constructor==Object){var i=[];for(var a in e)void 0===e[a]||r&&!e[a]&&0!==e[a]&&!1!==e[a]||i.push(a);i.sort(),_=t+"{\n";for(var o=0;o<i.length;o++)_+=t+'  "'+(a=i[o])+'":'+this._sortJson(e[a],r,t+"  "),o<i.length-1?_+=",\n":_+="\n";_+=t+"}"}else if(e&&e.constructor==Array){_=t+"[\n";for(var a in e)_+=this._sortJson(e[a],r,t+" "),a<e.length-1?_+=",\n":_+="\n";_+=t+"]"}else _=JSON.stringify(e);return _}};